# Movies Scrapy Parser (Wikipedia → CSV + IMDb rating)

Scrapy-парсер, который собирает информацию о фильмах из категорий русской Википедии и сохраняет результат в CSV.

## Функционал парсера
Парсер собирает по каждому фильму поля:

- **Название** (`title`)
- **Жанр** (`genre`)
- **Режиссёр** (`director`)
- **Страна** (`country`)
- **Год** (`year`)
- **Рейтинг IMDb** (`imdb_rating`) — *доп. задание* (если на странице Википедии есть ссылка на IMDb)

Результаты сохраняются в **CSV** (с кодировкой `utf-8-sig`, чтобы корректно открывалось в Excel).

---

## Источники данных (откуда парсим)
### 1) Wikipedia (RU) — основная база фильмов
Парсер стартует с 2 категорий Википедии:

- Категория: **Фильмы по алфавиту**
  - https://ru.wikipedia.org/wiki/Категория:Фильмы_по_алфавиту
- Категория: **Фильмы по годам**
  - https://ru.wikipedia.org/wiki/Категория:Фильмы_по_годам

Из страниц категорий парсер:
- забирает ссылки на страницы фильмов (статьи),
- рекурсивно обходит подкатегории (актуально для “по годам”),
- переходит по “Следующая страница” в категории (пагинация),
- останавливается по лимиту `max_movies`, чтобы не парсить бесконечно.

### 2) IMDb — дополнительный рейтинг
Если на странице фильма в Википедии найдена ссылка вида:
`https://www.imdb.com/title/ttXXXXXXX/`  
парсер дополнительно идёт на IMDb и вытаскивает **ratingValue** (рейтинг) из JSON-LD или из DOM (fallback).

---

## Как ведётся парсинг. Алгоритм

### A. Входные страницы (start_urls)
1) Spider открывает стартовые страницы категорий Википедии (`start_urls`).
2) На каждой категории он ищет:
   - блок **подкатегорий** (`#mw-subcategories`) → заходит внутрь рекурсивно,
   - блок **страниц** (`#mw-pages`) → находит ссылки на статьи,
   - ссылку **"Следующая страница"** → пагинация категории.

### B. Сбор ссылок на фильмы
3) Из `#mw-pages` берутся ссылки на статьи (`/wiki/...`).
4) Отсекаются служебные страницы:
   - ссылки с двоеточием в названии (например `Special:`, `Категория:`),
   - не-статьи и системные разделы.

### C. Парсинг страницы фильма
5) Для каждой страницы фильма spider открывает статью и пытается достать данные из инфобокса:
   - `Жанр / Жанры`
   - `Режиссёр / Режиссер / Режиссёр-постановщик`
   - `Страна / Страны`
   - `Год / Дата выхода / Премьера`
6) Год приводится к виду `YYYY` (первое найденное 4-значное число года).

### D. IMDb (доп. задание)
7) Если на странице Википедии найден IMDb `tt-id`, spider делает запрос на IMDb:
   - сначала пытается вытащить `ratingValue` из JSON-LD,
   - если не получилось — пробует DOM-селектор (fallback).
8) Рейтинг добавляется в поле `imdb_rating`. Если ссылки на IMDb нет — поле остаётся пустым.

### E. Экспорт в CSV
9) Scrapy FEED Exporter сохраняет items в CSV:
- по умолчанию: `movies.csv`
- порядок полей фиксирован: `title, genre, director, country, year, imdb_rating`